<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Management System</title>
</head>
<body>
    <h1>Bus Management System</h1>

    <!-- Add Bus Schedule Form -->
    <h2>Add Bus Schedule</h2>
    <label for="busId">Bus ID:</label>
    <input type="text" id="busId"><br>
    <label for="startDestination">Start Destination:</label>
    <input type="text" id="startDestination"><br>
    <label for="endDestination">End Destination:</label>
    <input type="text" id="endDestination"><br>
    <label for="startTime">Start Time:</label>
    <input type="number" id="startTime"><br>
    <label for="endTime">End Time:</label>
    <input type="number" id="endTime"><br>
    <label for="availableSeats">Available Seats:</label>
    <input type="number" id="availableSeats"><br>
    <label for="ticketPrice">Ticket Price:</label>
    <input type="number" id="ticketPrice"><br>
    <button onclick="addBusSchedule()">Add Bus Schedule</button>

    <!-- Schedule Details -->
    <h2>Schedule Details</h2>
    <label for="scheduleId">Enter Schedule ID:</label>
    <input type="number" id="scheduleId">
    <button onclick="getScheduleDetails()">Get Schedule Details</button>
    <div id="scheduleDetails"></div>

    <!-- Issue Ticket -->
    <h2>Issue Ticket</h2>
    <label for="issueScheduleId">Schedule ID:</label>
    <input type="number" id="issueScheduleId"><br>
    <label for="seatNumber">Seat Number:</label>
    <input type="number" id="seatNumber"><br>
    <button onclick="issueTicket()">Issue Ticket</button>
    <div id="ticketIssued"></div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <script>
        const contractAddress = 'CONTRACT_ADDRESS'; // Replace with your contract address
        const abi = [YOUR_CONTRACT_ABI]; // Replace with your contract ABI
        const web3 = new Web3('https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID'); // Replace with your Infura project ID

        async function addBusSchedule() {
            const accounts = await web3.eth.getAccounts();
            const contract = new web3.eth.Contract(abi, contractAddress);
            const busId = document.getElementById('busId').value;
            const startDestination = document.getElementById('startDestination').value;
            const endDestination = document.getElementById('endDestination').value;
            const startTime = parseInt(document.getElementById('startTime').value);
            const endTime = parseInt(document.getElementById('endTime').value);
            const availableSeats = parseInt(document.getElementById('availableSeats').value);
            const ticketPrice = parseInt(document.getElementById('ticketPrice').value);
            await contract.methods.addBusSchedule(busId, startDestination, endDestination, startTime, endTime, availableSeats, ticketPrice).send({ from: accounts[0] });
            alert('Bus schedule added successfully!');
        }

        async function getScheduleDetails() {
            const scheduleId = parseInt(document.getElementById('scheduleId').value);
            const contract = new web3.eth.Contract(abi, contractAddress);
            const result = await contract.methods.getScheduleDetails(scheduleId).call();
            document.getElementById('scheduleDetails').innerHTML = `<p>Bus ID: ${result[0]}</p>
                                                                    <p>Start Destination: ${result[1]}</p>
                                                                    <p>End Destination: ${result[2]}</p>
                                                                    <p>Start Time: ${new Date(result[3] * 1000)}</p>
                                                                    <p>End Time: ${new Date(result[4] * 1000)}</p>
                                                                    <p>Available Seats: ${result[5]}</p>
                                                                    <p>Ticket Price: ${result[6]}</p>
                                                                    <p>Active: ${result[7]}</p>
                                                                    <p>Security Enabled: ${result[8]}</p>`;
        }

        async function issueTicket() {
            const accounts = await web3.eth.getAccounts();
            const scheduleId = parseInt(document.getElementById('issueScheduleId').value);
            const seatNumber = parseInt(document.getElementById('seatNumber').value);
            const contract = new web3.eth.Contract(abi, contractAddress);
            await contract.methods.issueTicket(scheduleId, seatNumber).send({ from: accounts[0] });
            alert('Ticket issued successfully!');
        }
    </script>
</body>
</html>

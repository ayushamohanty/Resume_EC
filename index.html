<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Management System</title>
</head>
<body>
    <h1>Bus Management System</h1>
    <label for="scheduleId">Enter Schedule ID:</label>
    <input type="number" id="scheduleId">
    <button onclick="getScheduleDetails()">Get Schedule Details</button>
    <div id="scheduleDetails"></div>

    <h2>Issue Ticket</h2>
    <label for="seatNumber">Enter Seat Number:</label>
    <input type="number" id="seatNumber">
    <button onclick="issueTicket()">Issue Ticket</button>
    <div id="ticketIssued"></div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <script>
        const contractAddress = 'YOUR_CONTRACT_ADDRESS';
        const abi = YOUR_CONTRACT_ABI;
        let web3;

        async function init() {
            // Check if MetaMask is installed
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                await window.ethereum.enable(); // Request access to user's accounts
            } else {
                alert('MetaMask extension not detected. Please install MetaMask to use this feature.');
            }
        }

        async function getScheduleDetails() {
            await init(); // Initialize MetaMask
            const accounts = await web3.eth.getAccounts();
            const scheduleId = document.getElementById('scheduleId').value;
            const contract = new web3.eth.Contract(abi, contractAddress);
            const result = await contract.methods.getScheduleDetails(scheduleId).call({ from: accounts[0] });
            document.getElementById('scheduleDetails').innerHTML = `<p>Bus ID: ${result[0]}</p>
                                                                    <p>Start Destination: ${result[1]}</p>
                                                                    <p>End Destination: ${result[2]}</p>
                                                                    <p>Start Time: ${result[3]}</p>
                                                                    <p>End Time: ${result[4]}</p>
                                                                    <p>Available Seats: ${result[5]}</p>
                                                                    <p>Ticket Price: ${result[6]}</p>
                                                                    <p>Active: ${result[7]}</p>
                                                                    <p>Security Enabled: ${result[8]}</p>`;
        }

        async function issueTicket() {
            await init(); // Initialize MetaMask
            const accounts = await web3.eth.getAccounts();
            const scheduleId = document.getElementById('scheduleId').value;
            const seatNumber = document.getElementById('seatNumber').value;
            const contract = new web3.eth.Contract(abi, contractAddress);
            await contract.methods.issueTicket(scheduleId, seatNumber).send({ from: accounts[0] });
            document.getElementById('ticketIssued').innerHTML = `<p>Ticket issued successfully!</p>`;
        }

        init(); // Initialize MetaMask on page load
    </script>
</body>
</html>
